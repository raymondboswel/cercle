!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=10)}([function(e,t){function n(e,t,n){o.open("get",e),o.responseType="blob",o.onload=function(){200===o.status?t(o.response):n(o.status)},o.send()}function i(e,t,n){o.open("put",t),o.setRequestHeader("Content-Type",e.type),o.onload=function(){200===o.status&&n()},o.send(e)}var o;e.exports=function(){return o=new XMLHttpRequest,{get:function(e,t,i){n(e,t,i)},upload:function(e,t,n){i(e,t,n)}}}},function(e,t,n){n(8),window.HIGURU_SDK=n(4);n(2)},function(e,t,n){e.exports={socketUrl:function(){return"wss://translator.hi.guru/socket"},companyUUID:function(){return"2e9f11e5-e07f-4835-810f-87f39576f999"}}},function(e,t,n){function i(){var e=document.getElementById("higuruChat"),t=document.createElement("div");t.id="higuru-chat-box",t.className="higuru-chat",t.appendChild(o()),t.appendChild(r()),t.appendChild(s()),t.style.display="none",e.appendChild(t)}function o(){var e=document.createElement("div");e.className="higuru-chat-header";var t=document.createElement("span");return t.appendChild(document.createTextNode("How can we help?")),t.className="header-text",e.appendChild(t),e}function r(){var e=document.createElement("div");return e.className="higuru-chat-block",e.id="higuru-chat-block",e}function s(){var e=document.createElement("div");e.className="higuru-chat-box";var t=document.createElement("div");t.className="higuru-compose-block",t.appendChild(a()),t.appendChild(c());var n=document.createElement("button");return n.className="higuru-btn higuru-send-button",n.appendChild(document.createTextNode("Send")),n.onclick=function(){g(document.getElementById("chat-input"))},t.appendChild(n),e.appendChild(t),e}function a(){var e=document.createElement("label");e.className="higuru-attach-button",e.appendChild(u()),e.onchange=function(e){C(e)};var t=document.createElement("input");return t.type="file",t.style="display:none",t.accept="audio/ogg,audio/mp3,audio/wav,video/mp4,video/ogg,video/webm,image/*,application/pdf",e.appendChild(t),e}function u(){var e=document.createElement("canvas"),t=e.getContext("2d"),n=window.URL||window.webkitURL||window,i=new Image,o=new Blob(['<svg width="36" height="36" xmlns="http://www.w3.org/2000/svg"><g><title>background</title><rect fill="none" id="canvas_background" height="38" width="38" y="-1" x="-1"/><g display="none" overflow="visible" y="0" x="0" height="100%" width="100%" id="canvasGrid"><rect fill="url(#gridpattern)" stroke-width="0" y="0" x="0" height="100%" width="100%"/></g></g><g><title>Layer 1</title><ellipse stroke="#4a90e2" ry="15" rx="15" id="svg_4" cy="18" cx="18" stroke-width="2" fill="none"/><g stroke="null" id="svg_8"><line stroke="#4a90e2" stroke-linecap="null" stroke-linejoin="null" id="svg_5" y2="18" x2="26.515241" y1="18" x1="9.484758" fill-opacity="null" stroke-width="2" fill="none"/><line stroke="#4a90e2" stroke-linecap="null" stroke-linejoin="null" id="svg_6" y2="26.515242" x2="18" y1="9.484757" x1="18" fill-opacity="null" stroke-width="2" fill="none"/></g></g></svg>'],{type:"image/svg+xml"}),r=n.createObjectURL(o);return i.onload=function(){t.drawImage(i,0,0),n.revokeObjectURL(r)},i.src=r,i}function c(){var e=document.createElement("div");e.className="higuru-input-container";var t=document.createElement("div");return t.className="div",t.setAttribute("contenteditable",!0),t.setAttribute("dir","auto"),t.setAttribute("spellcheck",!0),t.id="chat-input",t.className="higuru-input",e.appendChild(t),l(t),e}function l(e){e.addEventListener("keydown",function(e){13!=e.keyCode||e.shiftKey||(e.preventDefault(),g(document.getElementById("chat-input")))})}function d(){var e=document.createElement("div");e.className="higuru-modal",e.id="higuru-modal",closeButton=e.appendChild(document.createElement("span")),closeButton.className="higuru-modal-close-btn",closeButton.id="higuru-close",closeButton.onclick=function(){e=document.getElementById("higuru-modal"),e.style.display="none",e.removeChild(document.getElementById("higuru-modal-content"))},closeButton.appendChild(document.createTextNode("✖")),document.body.appendChild(e)}function h(){var e=document.getElementById("higuruChat");e.className="higuru-chat-icon";var t=document.createElement("button");t.className="higuru-btn higuru-button-round",t.id="higuru-chat-button",t.appendChild(f()),t.onclick=function(){m()},e.appendChild(t),e.addEventListener("toggleChat",function(e){console.log("Toggle chat event received"),m()},!1)}function f(){var e=document.createElement("img");return e.src=L,e}function m(){var e=document.getElementById("higuru-chat-button"),t=document.getElementById("higuru-chat-box");"flex"==t.style.display?(e.removeChild(e.firstChild),e.appendChild(f()),t.style.width="0px",t.style.height="0px",setTimeout(function(){t.style.display="none"},100)):(A.pushChatOpenedEvent(),console.log("Pushed chat open event"),e.removeChild(e.firstChild),e.appendChild(p()),t.style.display="flex",t.style.width="0px",t.style.height="0px",setTimeout(function(){t.style.height=null,t.style.width="360px"},0))}function p(){return document.createTextNode("×")}function g(e){var t=A.messages().generateMessage(e.innerText,A.messages().messageTypes().TEXT,!0);""!=t.body.trim()&&(y(e),v(t))}function v(e){b(e),A.messages().addMessageToList(e),A.messages().addMessageinArray(e)}function y(e){e.innerText=""}function b(e){var t={message:{text:e.body,id:e.id,uuid:A.uuid(),company_uuid:A.companyUuid(),message_type:A.messages().messageTypes().TEXT}};console.log(t),A.pushMessage(t)}function k(e){switch(e.type){case A.messages().messageTypes().IMAGE:case A.messages().messageTypes().VIDEO:I(e);break;case A.messages().messageTypes().AUDIO:case A.messages().messageTypes().PDF:R(e)}}function C(e){var t=e.dataTransfer?e.dataTransfer.files[0]:e.target.files[0],n=E(t);A.putUrl(function(e){n.id=e.message_id,w(t,function(e){n.thumbnail=e,n.isLoaded=!0,n.isLoading=!0,n.contentType=t.type,A.messages().addMessageToList(n)}),P.upload(t,e.url,function(){n.isUploaded=!0,n.isLoading=!1,A.messages().addMessageinArray(n),k(n),O(n)})})}function E(e){var t=URL.createObjectURL(e),n=A.messages().generateMessage("",x(e),!0);return n.url=t,n.isUploaded=!1,n.type==A.messages().messageTypes().PDF&&(n.body=e.name),n}function x(e){return e.type.split("/")[0]}function w(e,t){var n=new FileReader;n.onload=function(){var i;if("image"==x(e))console.log("IMage file"),i=new Image,i.src=n.result,i.crossOrigin="Anonymous",i.onload=function(){var e=N(i);t(e)};else if("video"==x(e)){i=document.createElement("video");var o=document.createElement("source");o.src=n.result,o.type=e.type,i.appendChild(o),i.addEventListener("loadeddata",function(){this.removeEventListener("loadeddata",arguments.callee),this.removeEventListener("error",arguments.callee);var e=N(i);t(e)})}else t(null)},n.readAsDataURL(e)}function N(e){var t=document.createElement("canvas"),n=T(e.offsetWidth,e.offsetHeight),i=S(n,2);return t.width=i[0],t.height=i[1],t.getContext("2d").drawImage(e,0,0,t.width,t.height),console.log(t),t.toDataURL()}function T(e,t){try{var n=e/t,i=60,o=60;return e>60?o=60/n:t>60&&(i=60/n),o>60?(o=60,i=60*n):i>60&&(i=60,o=60/n),[i,o]}catch(e){throw"Could not scale thumbnail"}}function I(e){var t={message:{text:e.body,id:e.id,uuid:A.uuid(),company_uuid:A.companyUuid(),message_type:e.type,thumbnail:j(e.thumbnail)}};A.pushMessage(t)}function j(e){return e.split(",")[1]}function O(e){var t=document.getElementById(e.id);if(t){t.parentElement.firstChild.className="",t.parentElement.removeChild(t)}}function R(e){var t={message:{text:e.body,id:e.id,uuid:A.uuid(),company_uuid:A.companyUuid(),message_type:e.type}};A.pushMessage(t)}var A,S=function(){function e(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(o)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),L="data:image/png;base64,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",P=n(0)();e.exports=function(e){return A=e,{generate:function(){i(),d(),h()}}}},function(e,t,n){var i=i||{},o=n(7)(),r=n(3)(o);i=function(){function e(e,i){console.log("init called with"+e),n=e,socket_url=i,t(),o.connectChat(i,e),o.addHandlers()}function t(){r.generate(),o.messages().generateMessagesFromStorage()}var n;return{init:function(t,n){return e(t,n)}}}(),e.exports=i},function(e,t,n){function o(e){var t=l(e),n=document.createElement("span");return n.className="higuru-message-text",n.appendChild(document.createTextNode(e.body)),t.firstChild.appendChild(n),t.firstChild.appendChild(d(e)),t}function r(e){var t=o(e,!1),n=document.createElement("div");return n.appendChild(generateButton("Yes",yesCallback)),n.appendChild(generateButton("No",noCallback)),n.className="higuru-button-container",t.firstChild.appendChild(n),t}function s(e){var t=l(e),n=document.createElement("img");return n.src=e.isLoaded?e.url:e.thumbnail,n.onclick=function(){modal=document.getElementById("higuru-modal"),y(),modalImg=modal.appendChild(document.createElement("img")),modalImg.id="higuru-modal-content",modalImg.src=n.src,modalImg.className="higuru-modal-content",modal.style.display="block"},n.setAttribute("class","higuru-image"),t.firstChild.appendChild(n),t.firstChild.appendChild(d(e)),h(t,n,e),t}function a(e){var t=l(e),n=document.createElement("video");if(n.setAttribute("controls","controls"),e.isLoaded||(n.poster=e.thumbnail),n.setAttribute("style","max-width:100%; width:300px;"),e.isLoaded){var i=document.createElement("source");i.src=e.url,i.type=e.contentType,n.appendChild(i)}return t.firstChild.appendChild(n),t.firstChild.appendChild(d(e)),h(t,n,e),t}function u(e){var t=l(e),n=document.createElement("audio");if(n.setAttribute("controls","controls"),n.setAttribute("style","max-width:100%; width:300px;"),e.isLoaded){var i=document.createElement("source");i.src=e.url,i.type=e.contentType,n.appendChild(i)}return t.firstChild.appendChild(n),t.firstChild.appendChild(d(e)),h(t,n,e),t}function c(e){console.log("generatePdfView");var t=l(e),n=document.createElement("i");n.className="fa fa-file-pdf-o";var i=document.createElement("a");i.className="pdf-link",i.href=e.url,i.target="_blank",i.appendChild(n),i.appendChild(document.createTextNode(" "+e.body)),t.firstChild.appendChild(i);var o=document.createElement("span");return i.onclick=function(){modal=document.getElementById("higuru-modal"),y(),modalIframe=modal.appendChild(document.createElement("iframe")),modalIframe.id="higuru-modal-content",modalIframe.src=i.href,modalIframe.className="higuru-modal-content higuru-modal-content-iframe",modal.style.display="block"},o.className="higuru-message-text",t.firstChild.appendChild(o),t.firstChild.appendChild(d(e)),h(t,i,e),t}function l(e){var t=document.createElement("div");t.className="higuru-message-block";var n=document.createElement("div");return n.className="higuru-message-item",n.className+=e.isSender?" higuru-sent":" higuru-received",t.className+=e.isSender?" higuru-right":"",t.appendChild(n),t}function d(e){var t=document.createElement("div");t.className="higuru-stamp",date=new Date(e.timestamp);var n=("0"+date.getHours()).slice(-2)+":"+("0"+date.getMinutes()).slice(-2);return t.appendChild(document.createTextNode(n)),t}function h(e,t,n){n.isLoaded||(e.firstChild.appendChild(f(n.id)),n.type==C&&(t.className=" higuru-blur")),n.isLoading&&(e.firstChild.appendChild(m(n.id)),n.type==C&&(t.className=" higuru-blur"))}function f(e){var t=document.createElement("div");t.className="higuru-overlay",t.id=e;var n=document.createElement("div");n.className="higuru-download-block";var i=document.createElement("i");return i.className="fa fa-download fa-2x",n.onclick=function(t){p(n,e)},n.appendChild(i),t.appendChild(n),t}function m(e){var t=document.createElement("div");t.className="higuru-overlay",t.id=e;var n=document.createElement("div");return n.className="higuru-download-block",n.appendChild(g()),t.appendChild(n),t}function p(e,t){downloadIcon=e.firstChild,downloadIcon.style="display: none";var n=g();e.appendChild(n),b.getUrl(t,function(t){E.get(t.url,function(t){objectUrl=URL.createObjectURL(t);var n=e.parentElement.parentElement.firstChild;if("IMG"==n.tagName)n.src=objectUrl;else if("A"==n.tagName)n.href=objectUrl,n.onclick=function(){modal=document.getElementById("higuru-modal"),y(),modalIframe=modal.appendChild(document.createElement("iframe")),modalIframe.id="higuru-modal-content",modalIframe.src=URL.createObjectURL(t),modalIframe.className="higuru-modal-content higuru-modal-content-iframe",modal.style.display="block"};else{n.className="";var i=document.createElement("source");i.src=objectUrl,i.type=t.type,n.appendChild(i),n.onclick=function(){n.paused?n.play():n.pause()}}var o=e.parentElement;o.parentElement.removeChild(o)},function(e){console.error(e)})})}function g(){var e=document.createElement("div");return e.id="circularG",v().forEach(function(t){e.appendChild(t)},this),e}function v(){var e=[];for(i=1;i<=8;i++){var t=document.createElement("div");t.id="circularG_"+i,t.className="circularG",e.push(t)}return e}function y(){modalContent=document.getElementById("higuru-modal-content"),modalContent&&modalContent.parentElement.removeChild(modalContent)}var b,k={TEXT:"text",RESOLVE:"resolve",IMAGE:"image",VIDEO:"video",AUDIO:"audio",PDF:"application",LOCATION:"location"},C=k.VIDEO||k.AUDIO,E=n(0)();e.exports=function(e){return b=e,{generateView:function(e){switch(e.type){case k.TEXT:return o(e);case k.RESOLVE:return r(e);case k.IMAGE:return s(e);case k.VIDEO:return a(e);case k.AUDIO:return u(e);case k.PDF:return c(e)}}}}},function(e,t,n){function i(){return"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function o(e){console.log(e);var t=document.getElementById("higuru-chat-block");t.appendChild(c.generateView(e)),t.lastChild.scrollIntoView()}function r(e){h.push(e),u("messages",h)}function s(){if(!(h=a("messages")))return void(h=[]);h.forEach(function(e){e.isLoaded=!1,o(e)},this)}function a(e){return JSON.parse(sessionStorage.getItem(e))}function u(e,t){sessionStorage.setItem(e,JSON.stringify(t))}var c,l,d={TEXT:"text",RESOLVE:"resolve",IMAGE:"image",VIDEO:"video",AUDIO:"audio",PDF:"application",LOCATION:"location"},h=[];e.exports=function(e){return l=e,c=n(5)(l),{generateMessage:function(e,t,n,o){var r=new Object;return r.id=o||i(),r.body=e,r.isSender=n,r.type=t,r.timestamp=new Date,r},messageTypes:function(){return d},addMessageToList:function(e){o(e)},addMessageinArray:function(e){r(e)},generateMessagesFromStorage:function(){s()}}}},function(e,t,n){function i(){var e=n(9);C=new e.Socket(E,{params:{token:window.userToken}}),C.connect()}function o(){r()?l():c(function(e){s(e),l()})}function r(){return a("uuid")}function s(e){u("uuid",e)}function a(e){return JSON.parse(sessionStorage.getItem(e))}function u(e,t){sessionStorage.setItem(e,JSON.stringify(t))}function c(e){d("room:lobby",function(){x.push(I,{company_uuid:k}).receive("ok",function(t){e(t)})})}function l(){var e=r();w=e.uuid,d("room:"+e.room,function(){x.on(j,h),f()})}function d(e,t){x=C.channel(e,{}),x.join().receive("ok",function(n){console.log("Joined "+e+" successfully",n),t()}).receive("error",function(e){throw"Could not join room"})}function h(e){console.log(e),console.log(N);var t=N.generateMessage(e.text,e.type,!1,e.id);e.type!=N.messageTypes().VIDEO&&e.type!=N.messageTypes().IMAGE||(t.thumbnail="data:image/png;base64,"+e.thumbnail),N.addMessageToList(t),N.addMessageinArray(t)}function f(){x.push(O,{company_uuid:k}).receive("ok",function(e){if(1==e.web_sdk_setting.enabled){if(1==e.web_sdk_setting.disable_when_agents_offline)m();else if(g(),console.log(e.company_unit_setting.default_bot),e.company_unit_setting.default_bot){var t=new Event("toggleChat",{bubbles:!0,cancelable:!1}),n=document.getElementById("higuru-chat-button"),i=n.dispatchEvent(t);console.log("fired event: "+i)}}else p()})}function m(){x.push(T,{company_uuid:k}).receive("ok",function(e){1==e.agents_online?g():p()})}function p(){console.log("hideSdk"),document.getElementById("higuruChat").style.visibility="hidden",document.getElementById("higuru-chat-button").style.visibility="hidden"}function g(){console.log("showSdk"),document.getElementById("higuruChat").style.visibility="visible",document.getElementById("higuru-chat-button").style.visibility="visible"}function v(e){console.log(e)}function y(e,t){x&&x.push(R,{message_id:e}).receive("ok",function(e){t(e)})}function b(e){x&&x.push(A).receive("ok",function(t){e(t)})}var k,C,E,x,w,N,T="request:agents_online",I="request:consumer_uuid",j="new_msg",O="request:settings",R="request:get_url",A="request:put_url";e.exports=function(){return obj={messages:function(){return N},pushMessage:function(e){x&&x.push("new_msg",e).receive("ok",console.log)},pushChatOpenedEvent:function(){x?x.push("chat_opened").receive("ok",function(e){return console.log(e)}):console.log("Channel undefined")},connectChat:function(e,t){k=t,E=e,i(),o()},addHandlers:function(){x.on(R,function(e){v(e)})},uuid:function(){return w},companyUuid:function(){return k},getUrl:function(e,t){y(e,t)},putUrl:function(e){b(e)}},N=n(6)(obj),obj}},function(e,t){},function(e,t,n){"use strict";function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a={connecting:0,open:1,closing:2,closed:3},u=1e4,c={closed:"closed",errored:"errored",joined:"joined",joining:"joining",leaving:"leaving"},l={close:"phx_close",error:"phx_error",join:"phx_join",reply:"phx_reply",leave:"phx_leave"},d={longpoll:"longpoll",websocket:"websocket"},h=function(){function e(t,n,i,r){o(this,e),this.channel=t,this.event=n,this.payload=i||{},this.receivedResp=null,this.timeout=r,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}return s(e,[{key:"resend",value:function(e){this.timeout=e,this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}},{key:"send",value:function(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref}))}},{key:"receive",value:function(e,t){return this.hasReceived(e)&&t(this.receivedResp.response),this.recHooks.push({status:e,callback:t}),this}},{key:"matchReceive",value:function(e){var t=e.status,n=e.response;e.ref;this.recHooks.filter(function(e){return e.status===t}).forEach(function(e){return e.callback(n)})}},{key:"cancelRefEvent",value:function(){this.refEvent&&this.channel.off(this.refEvent)}},{key:"cancelTimeout",value:function(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}},{key:"startTimeout",value:function(){var e=this;this.timeoutTimer||(this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,function(t){e.cancelRefEvent(),e.cancelTimeout(),e.receivedResp=t,e.matchReceive(t)}),this.timeoutTimer=setTimeout(function(){e.trigger("timeout",{})},this.timeout))}},{key:"hasReceived",value:function(e){return this.receivedResp&&this.receivedResp.status===e}},{key:"trigger",value:function(e,t){this.channel.trigger(this.refEvent,{status:e,response:t})}}]),e}(),f=t.Channel=function(){function e(t,n,i){var r=this;o(this,e),this.state=c.closed,this.topic=t,this.params=n||{},this.socket=i,this.bindings=[],this.timeout=this.socket.timeout,this.joinedOnce=!1,this.joinPush=new h(this,l.join,this.params,this.timeout),this.pushBuffer=[],this.rejoinTimer=new g(function(){return r.rejoinUntilConnected()},this.socket.reconnectAfterMs),this.joinPush.receive("ok",function(){r.state=c.joined,r.rejoinTimer.reset(),r.pushBuffer.forEach(function(e){return e.send()}),r.pushBuffer=[]}),this.onClose(function(){r.rejoinTimer.reset(),r.socket.log("channel","close "+r.topic+" "+r.joinRef()),r.state=c.closed,r.socket.remove(r)}),this.onError(function(e){r.isLeaving()||r.isClosed()||(r.socket.log("channel","error "+r.topic,e),r.state=c.errored,r.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",function(){r.isJoining()&&(r.socket.log("channel","timeout "+r.topic,r.joinPush.timeout),r.state=c.errored,r.rejoinTimer.scheduleTimeout())}),this.on(l.reply,function(e,t){r.trigger(r.replyEventName(t),e)})}return s(e,[{key:"rejoinUntilConnected",value:function(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}},{key:"join",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;if(this.joinedOnce)throw"tried to join multiple times. 'join' can only be called a single time per channel instance";return this.joinedOnce=!0,this.rejoin(e),this.joinPush}},{key:"onClose",value:function(e){this.on(l.close,e)}},{key:"onError",value:function(e){this.on(l.error,function(t){return e(t)})}},{key:"on",value:function(e,t){this.bindings.push({event:e,callback:t})}},{key:"off",value:function(e){this.bindings=this.bindings.filter(function(t){return t.event!==e})}},{key:"canPush",value:function(){return this.socket.isConnected()&&this.isJoined()}},{key:"push",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '"+e+"' to '"+this.topic+"' before joining. Use channel.join() before pushing events";var i=new h(this,e,t,n);return this.canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}},{key:"leave",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=c.leaving;var n=function(){e.socket.log("channel","leave "+e.topic),e.trigger(l.close,"leave",e.joinRef())},i=new h(this,l.leave,{},t);return i.receive("ok",function(){return n()}).receive("timeout",function(){return n()}),i.send(),this.canPush()||i.trigger("ok",{}),i}},{key:"onMessage",value:function(e,t,n){return t}},{key:"isMember",value:function(e){return this.topic===e}},{key:"joinRef",value:function(){return this.joinPush.ref}},{key:"sendJoin",value:function(e){this.state=c.joining,this.joinPush.resend(e)}},{key:"rejoin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.isLeaving()||this.sendJoin(e)}},{key:"trigger",value:function(e,t,n){var i=l.close,o=l.error,r=l.leave,s=l.join;if(!(n&&[i,o,r,s].indexOf(e)>=0&&n!==this.joinRef())){var a=this.onMessage(e,t,n);if(t&&!a)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter(function(t){return t.event===e}).map(function(e){return e.callback(a,n)})}}},{key:"replyEventName",value:function(e){return"chan_reply_"+e}},{key:"isClosed",value:function(){return this.state===c.closed}},{key:"isErrored",value:function(){return this.state===c.errored}},{key:"isJoined",value:function(){return this.state===c.joined}},{key:"isJoining",value:function(){return this.state===c.joining}},{key:"isLeaving",value:function(){return this.state===c.leaving}}]),e}(),m=(t.Socket=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e),this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=i.timeout||u,this.transport=i.transport||window.WebSocket||m,this.heartbeatIntervalMs=i.heartbeatIntervalMs||3e4,this.reconnectAfterMs=i.reconnectAfterMs||function(e){return[1e3,2e3,5e3,1e4][e-1]||1e4},this.logger=i.logger||function(){},this.longpollerTimeout=i.longpollerTimeout||2e4,this.params=i.params||{},this.endPoint=t+"/"+d.websocket,this.reconnectTimer=new g(function(){n.disconnect(function(){return n.connect()})},this.reconnectAfterMs)}return s(e,[{key:"protocol",value:function(){return location.protocol.match(/^https/)?"wss":"ws"}},{key:"endPointURL",value:function(){var e=p.appendParams(p.appendParams(this.endPoint,this.params),{vsn:"1.0.0"});return"/"!==e.charAt(0)?e:"/"===e.charAt(1)?this.protocol()+":"+e:this.protocol()+"://"+location.host+e}},{key:"disconnect",value:function(e,t,n){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,n||""):this.conn.close(),this.conn=null),e&&e()}},{key:"connect",value:function(e){var t=this;e&&(console&&console.log("passing params to connect is deprecated. Instead pass :params to the Socket constructor"),this.params=e),this.conn||(this.conn=new this.transport(this.endPointURL()),this.conn.timeout=this.longpollerTimeout,this.conn.onopen=function(){return t.onConnOpen()},this.conn.onerror=function(e){return t.onConnError(e)},this.conn.onmessage=function(e){return t.onConnMessage(e)},this.conn.onclose=function(e){return t.onConnClose(e)})}},{key:"log",value:function(e,t,n){this.logger(e,t,n)}},{key:"onOpen",value:function(e){this.stateChangeCallbacks.open.push(e)}},{key:"onClose",value:function(e){this.stateChangeCallbacks.close.push(e)}},{key:"onError",value:function(e){this.stateChangeCallbacks.error.push(e)}},{key:"onMessage",value:function(e){this.stateChangeCallbacks.message.push(e)}},{key:"onConnOpen",value:function(){var e=this;this.log("transport","connected to "+this.endPointURL(),this.transport.prototype),this.flushSendBuffer(),this.reconnectTimer.reset(),this.conn.skipHeartbeat||(clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(function(){return e.sendHeartbeat()},this.heartbeatIntervalMs)),this.stateChangeCallbacks.open.forEach(function(e){return e()})}},{key:"onConnClose",value:function(e){this.log("transport","close",e),this.triggerChanError(),clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(function(t){return t(e)})}},{key:"onConnError",value:function(e){this.log("transport",e),this.triggerChanError(),this.stateChangeCallbacks.error.forEach(function(t){return t(e)})}},{key:"triggerChanError",value:function(){this.channels.forEach(function(e){return e.trigger(l.error)})}},{key:"connectionState",value:function(){switch(this.conn&&this.conn.readyState){case a.connecting:return"connecting";case a.open:return"open";case a.closing:return"closing";default:return"closed"}}},{key:"isConnected",value:function(){return"open"===this.connectionState()}},{key:"remove",value:function(e){this.channels=this.channels.filter(function(t){return t.joinRef()!==e.joinRef()})}},{key:"channel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new f(e,t,this);return this.channels.push(n),n}},{key:"push",value:function(e){var t=this,n=e.topic,i=e.event,o=e.payload,r=e.ref,s=function(){return t.conn.send(JSON.stringify(e))};this.log("push",n+" "+i+" ("+r+")",o),this.isConnected()?s():this.sendBuffer.push(s)}},{key:"makeRef",value:function(){var e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}},{key:"sendHeartbeat",value:function(){this.isConnected()&&this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.makeRef()})}},{key:"flushSendBuffer",value:function(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(function(e){return e()}),this.sendBuffer=[])}},{key:"onConnMessage",value:function(e){var t=JSON.parse(e.data),n=t.topic,i=t.event,o=t.payload,r=t.ref;this.log("receive",(o.status||"")+" "+n+" "+i+" "+(r&&"("+r+")"||""),o),this.channels.filter(function(e){return e.isMember(n)}).forEach(function(e){return e.trigger(i,o,r)}),this.stateChangeCallbacks.message.forEach(function(e){return e(t)})}}]),e}(),t.LongPoll=function(){function e(t){o(this,e),this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(t),this.readyState=a.connecting,this.poll()}return s(e,[{key:"normalizeEndpoint",value:function(e){return e.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+d.websocket),"$1/"+d.longpoll)}},{key:"endpointURL",value:function(){return p.appendParams(this.pollEndpoint,{token:this.token})}},{key:"closeAndRetry",value:function(){this.close(),this.readyState=a.connecting}},{key:"ontimeout",value:function(){this.onerror("timeout"),this.closeAndRetry()}},{key:"poll",value:function(){var e=this;this.readyState!==a.open&&this.readyState!==a.connecting||p.request("GET",this.endpointURL(),"application/json",null,this.timeout,this.ontimeout.bind(this),function(t){if(t){var n=t.status,i=t.token,o=t.messages;e.token=i}else var n=0;switch(n){case 200:o.forEach(function(t){return e.onmessage({data:JSON.stringify(t)})}),e.poll();break;case 204:e.poll();break;case 410:e.readyState=a.open,e.onopen(),e.poll();break;case 0:case 500:e.onerror(),e.closeAndRetry();break;default:throw"unhandled poll status "+n}})}},{key:"send",value:function(e){var t=this;p.request("POST",this.endpointURL(),"application/json",e,this.timeout,this.onerror.bind(this,"timeout"),function(e){e&&200===e.status||(t.onerror(status),t.closeAndRetry())})}},{key:"close",value:function(e,t){this.readyState=a.closed,this.onclose()}}]),e}()),p=t.Ajax=function(){function e(){o(this,e)}return s(e,null,[{key:"request",value:function(e,t,n,i,o,r,s){if(window.XDomainRequest){var a=new XDomainRequest;this.xdomainRequest(a,e,t,i,o,r,s)}else{var u=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.xhrRequest(u,e,t,n,i,o,r,s)}}},{key:"xdomainRequest",value:function(e,t,n,i,o,r,s){var a=this;e.timeout=o,e.open(t,n),e.onload=function(){var t=a.parseJSON(e.responseText);s&&s(t)},r&&(e.ontimeout=r),e.onprogress=function(){},e.send(i)}},{key:"xhrRequest",value:function(e,t,n,i,o,r,s,a){var u=this;e.timeout=r,e.open(t,n,!0),e.setRequestHeader("Content-Type",i),e.onerror=function(){a&&a(null)},e.onreadystatechange=function(){if(e.readyState===u.states.complete&&a){var t=u.parseJSON(e.responseText);a(t)}},s&&(e.ontimeout=s),e.send(o)}},{key:"parseJSON",value:function(e){return e&&""!==e?JSON.parse(e):null}},{key:"serialize",value:function(e,t){var n=[];for(var i in e)if(e.hasOwnProperty(i)){var o=t?t+"["+i+"]":i,s=e[i];"object"===(void 0===s?"undefined":r(s))?n.push(this.serialize(s,o)):n.push(encodeURIComponent(o)+"="+encodeURIComponent(s))}return n.join("&")}},{key:"appendParams",value:function(e,t){return 0===Object.keys(t).length?e:e+(e.match(/\?/)?"&":"?")+this.serialize(t)}}]),e}();p.states={complete:4};var g=(t.Presence={syncState:function(e,t,n,i){var o=this,r=this.clone(e),s={},a={};return this.map(r,function(e,n){t[e]||(a[e]=n)}),this.map(t,function(e,t){var n=r[e];if(n){var i=t.metas.map(function(e){return e.phx_ref}),u=n.metas.map(function(e){return e.phx_ref}),c=t.metas.filter(function(e){return u.indexOf(e.phx_ref)<0}),l=n.metas.filter(function(e){return i.indexOf(e.phx_ref)<0});c.length>0&&(s[e]=t,s[e].metas=c),l.length>0&&(a[e]=o.clone(n),a[e].metas=l)}else s[e]=t}),this.syncDiff(r,{joins:s,leaves:a},n,i)},syncDiff:function(e,t,n,o){var r=t.joins,s=t.leaves,a=this.clone(e);return n||(n=function(){}),o||(o=function(){}),this.map(r,function(e,t){var o=a[e];if(a[e]=t,o){var r;(r=a[e].metas).unshift.apply(r,i(o.metas))}n(e,o,t)}),this.map(s,function(e,t){var n=a[e];if(n){var i=t.metas.map(function(e){return e.phx_ref});n.metas=n.metas.filter(function(e){return i.indexOf(e.phx_ref)<0}),o(e,n,t),0===n.metas.length&&delete a[e]}}),a},list:function(e,t){return t||(t=function(e,t){return t}),this.map(e,function(e,n){return t(e,n)})},map:function(e,t){return Object.getOwnPropertyNames(e).map(function(n){return t(n,e[n])})},clone:function(e){return JSON.parse(JSON.stringify(e))}},function(){function e(t,n){o(this,e),this.callback=t,this.timerCalc=n,this.timer=null,this.tries=0}return s(e,[{key:"reset",value:function(){this.tries=0,clearTimeout(this.timer)}},{key:"scheduleTimeout",value:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout(function(){e.tries=e.tries+1,e.callback()},this.timerCalc(this.tries+1))}}]),e}())},function(e,t,n){e.exports=n(1)}]);